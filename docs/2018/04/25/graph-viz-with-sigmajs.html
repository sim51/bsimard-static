<!DOCTYPE html>
<html lang="en">
<head>
  <title>How to use Sigmajs to display your graph ?</title>
<meta charset="UTF-8">
<meta name="og:title" content="How to use Sigmajs to display your graph ?"/>
<meta name="og:type" content="article"/>
<meta name="og:url" content="http://www.bsimard.com/2018/04/25/graph-viz-with-sigmajs.html"/>
<meta name="og:description" content="In this article, I will show how to display and customize a graph in a browser with the help of SigmaJS"/>
<meta name="og:image" content="http://www.bsimard.com/public/images/sigmajs/banner.png"/>
<meta name="author" content="Benoit Simard"/>
<meta name="robots" content="index, follow" />
<meta name="description" content="In this article, I will show how to display and customize a graph in a browser with the help of SigmaJS" />
<meta name="keywords" content="sigma, graph, visualisation, dataviz" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="google-site-verification" content="Aer6BmLRp_kjily3ltrCqys_5KBaRaS_iVIe73dlgVw" />

<!-- Favicon -->
<link rel="shortcut icon" type="image/png" href="/public/images/bsimard.png">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" type="text/css" media="all" href="/public/stylesheets/main.css">

<!-- RSS feed -->
<link rel="alternate" type="application/rss+xml" title="RSS" href="/en/feed.xml" />

</head>
<body class="page">

  <!-- Navbar -->
<header class="navbar navbar-inverse navbar-fixed-top hidden-print">
    <div class="navbar-inner">
        <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="brand" href="/en" title="Benoît Simard">
                <img class="baseline" src="/public/images/bsimard.png" alt="Benoît SImard"/>
            </a>
            <nav class="nav-collapse collapse">
                <ul class="nav navbar-nav">
                  
                  
                    
                  
                    
                  
                    
                      <li><a href="/en/" title="Home">Home</a></li>
                    
                  
                    
                  
                    
                      <li><a href="/en/blog/" title="Blog">Blog</a></li>
                    
                  
                    
                  
                </ul>

                <ul class="nav navbar-nav navbar-right">
                  
                  
                    
                        <li>
                        <a href="/2018/04/25/graph-viz-with-sigmajs.html" class="en">en</a>
                        </li>
                    
                  

                  
                  
                </ul>
            </nav>
        </div>
    </div>
</header>

  <section class="firstBlock blockDefault mainContainer container">
    <section>
      <article class="row-fluid" itemscope itemtype="http://schema.org/BlogPosting">
        <div class="span12">
          <header>
            <h1 itemprop="name"> How to use Sigmajs to display your graph ?</h1>
            <meta itemprop="description" content=" In this article, I will show how to display and customize a graph in a browser with the help of SigmaJS">
            <img itemprop="image" src="/public/images/sigmajs/banner.png"/>
          </header>
          <section itemprop="articleBody">
            <div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">Introduction</a></li>
<li><a href="#installation">Installation</a>
<ul class="sectlevel2">
<li><a href="#how-to">How-to</a></li>
<li><a href="#how-to-choose-between-svg-canvas-and-webgl">How to choose between SVG, Canvas and Webgl ?</a></li>
</ul>
</li>
<li><a href="#the-sigmajs-graph-structure">The SigmaJS graph structure</a>
<ul class="sectlevel2">
<li><a href="#definition">Definition</a></li>
<li><a href="#example">Example</a></li>
<li><a href="#loading-graph-in-sigma">Loading graph in sigma</a></li>
<li><a href="#live-example">Live example</a></li>
</ul>
</li>
<li><a href="#graph-layout-algorithm">Graph layout algorithm</a>
<ul class="sectlevel2">
<li><a href="#definition-2">Definition</a></li>
<li><a href="#force-atlas2">Force-Atlas2</a></li>
<li><a href="#live-example-2">Live example</a></li>
</ul>
</li>
<li><a href="#plugins">Plugins</a>
<ul class="sectlevel2">
<li><a href="#edge-labels">Edge labels</a></li>
<li><a href="#edge-paralleledges">Edge parallelEdges</a></li>
<li><a href="#relative-size">Relative size</a></li>
</ul>
</li>
<li><a href="#sigma-and-neo4j">Sigma and Neo4j</a>
<ul class="sectlevel2">
<li><a href="#create-a-graph-structure-from-a-neo4j-query">Create a graph structure from a Neo4j query</a></li>
<li><a href="#neo4j-sigma-neosig">Neo4j + Sigma = NeoSig</a></li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this article, I will show how to display and customize a graph in a browser with the help of <a href="http://sigmajs.org">SigmaJS</a>,
a JS library dedicated to graph drawing delivered under the <a href="https://opensource.org/licenses/MIT">MIT licence</a>.</p>
</div>
<div class="paragraph">
<p>Initially, SigmaJS has been developed for <a href="https://gephi.org/">Gephi</a> to export a graph on the web.
Today, <a href="http://sigmajs.org">sigmajs</a> is a stable, full features and highly configurable graph library.
Moreover, the small cherry on the cake is its compatibility with touch screens.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installation">Installation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="how-to">How-to</h3>
<div class="paragraph">
<p>There are four steps to follow :</p>
</div>
<div class="paragraph">
<p><strong>Step 1 : Install sigmajs binaries</strong></p>
</div>
<div class="paragraph">
<p><a href="http://sigmajs.org">sigmajs</a> can be found on :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.npmjs.com/package/sigma">NPM</a> : you just have to type : <code>npm sigma --save-dev</code></p>
</li>
<li>
<p><a href="https://github.com/jacomyal/sigma.js/releases">Github</a> : download the <code>build.zip</code> from a release like <a href="https://github.com/jacomyal/sigma.js/releases/download/v1.2.0/build.zip">this</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Step 2 : Import the JavaScript library in your web page</strong></p>
</div>
<div class="paragraph">
<p>The minimal script you have to load is : <code>&lt;script src="./build/sigma.min.js"&gt;&lt;/script&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Personally, I prefer to import all the source files, it helps to lighten the library by removing the unused source files (ex: I don&#8217;t need SVG &amp; Webgl renderers if I use canvas).</p>
</div>
<div class="paragraph">
<p><strong>Step 3 :  Create an HTML container</strong></p>
</div>
<div class="paragraph">
<p>You have to create an HTML element, for example a <code>div</code> with an <code>id</code> like this : <code>&lt;div id='sigma-container'&gt;&lt;/div&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Moreover, you also need to give it an  <code>height</code> and <code>width</code>, otherwise it will have a size of 0 pixel.
This is easily done with some CSS : <code>#sigma-container { width:100%, height:100%}</code></p>
</div>
<div class="paragraph">
<p><strong>Step 4: Initialize sigmajs</strong></p>
</div>
<div class="paragraph">
<p>To initialize Sigmajs, you need to call the function <code>sigma</code> with those arguments :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <strong>render</strong> : it contains the HTML element  that sigmajs will use to display the graph, plus the type of renderer (SVG, canvas or WebGL)</p>
</li>
<li>
<p>sigmajs&#8217;s <strong>settings</strong> : this object will override the default settings, so you can pass an empty object for now. The complete settings list is available <a href="https://github.com/jacomyal/sigma.js/wiki/Settings">here</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At the end, you should have something like that :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;SigmaJS example&lt;/title&gt;
    &lt;script src="./build/sigma.min.js"&gt;&lt;/script&gt;
    &lt;style&gt;
      html { height:100%;}
      body {height: 100%;}
      #sigma-container { width:100%; height:100%; background-color:#E1E1E1}
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id='sigma-container'&gt;&lt;/div&gt;
    &lt;script&gt;
      // Initialize sigma:
      var s = new sigma(
        {
           renderer: {
             container: document.getElementById('sigma-container'),
             type: 'canvas'
           },
           settings: {}
         }
       );
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="how-to-choose-between-svg-canvas-and-webgl">How to choose between SVG, Canvas and Webgl ?</h3>
<div class="paragraph">
<p><a href="http://sigmajs.org">SigmaJS</a> can used one this technology to display your graph : <strong>svg</strong>, <strong>canvas</strong> &amp; <strong>webgl</strong>.</p>
</div>
<div class="paragraph">
<p><strong>SVG</strong> is a markup language, directly interpreted by your browser,
so it&#8217;s easy to customize nodes &amp; edges style, you just have to add some CSS rules.
But when you apply a layout algorithm on the graph, you continuously change the DOM of the SVG,
and if this DOM is heavy, the result is slow and can freeze your browser.</p>
</div>
<div class="paragraph">
<p><strong>Canvas</strong> is an HTML5 element compatible with all modern browsers.
It defines an area on your web page where you can draw some pixels by using a JavaScript API.
The JavaScript code is directly interpreted by your browser and it decides what and when to render.
Due to this, Canvas scales more than the SVG, but if you want to change the color of a shape, you need a way to specify it in the code.</p>
</div>
<div class="paragraph">
<p>On the other hand, there is <strong>WebGL</strong>, compatible with almost all newest browsers (even if the API is not stable).
As in Canvas, you need to write some JavaScript code for rendering your visualisation,
but this time, its computation is delegated to <strong>OpenGL</strong> so to your <strong>GPU</strong>.</p>
</div>
<div class="paragraph">
<p>To resume :</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"><strong>SVG</strong></th>
<th class="tableblock halign-left valign-top"><strong>Canvas</strong></th>
<th class="tableblock halign-left valign-top"><strong>WebGL</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Browser compatibility</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL (even old ones)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modern browsers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Render phases</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SVG creation &gt; Browser parsing &gt; Browser rendering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JS code &gt; Browser rendering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JS Code &gt; OpenGL rendering</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Performance</strong><br>
to display a large graph (more than 1000 elements)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Slow</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Performant</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The choice will depend on your needs, and also of the <a href="http://sigmajs.org">SigmaJS</a> plugins you want to use (plugins are not compatible with every format).</p>
</div>
<div class="paragraph">
<p>I suggest you to choose <strong>Canvas</strong> or <strong>Webgl</strong> if you want to really display a big graph.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-sigmajs-graph-structure">The SigmaJS graph structure</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="definition">Definition</h3>
<div class="paragraph">
<p>Now that sigma is initialized, we need to give it a graph.
It structure is simple : an object with an array of nodes and an array of edges.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Node definition</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node identifier, must be unique across all the node</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>label</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>x</code> &amp; <code>y</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Position of the node in 2D. Can be initialize with <code>Math.random()</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No  <em>(0)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size of the node that is use to render it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>color</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Color RGB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No <em>(<code>defaultNodeColor</code>)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Color used to display the node.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Edge definition</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edge identifier, must be unique across all the edge.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>source</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starting node&#8217;s identifier of the edge.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ending node&#8217;s identifier of the edge.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>line</code>,<br>
<code>curve</code>,<br>
<code>arrow</code> or<br>
<code>curvedArrow</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No <em>(line)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edge type for its render.<br>
The choice will depend on if you want to display an oriented graph. If so, you need an arrow type.
And if you want to display a high number of edges, it&#8217;s faster to use a line type (ie. line or arrow).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No <em>(<code>minEdgeSize</code>)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size of the edge that is use to render it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>color</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Color RGB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No <em>(<code>defaultEdgeColor</code>)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Color used to display the edge.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="example">Example</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var graph = {
  nodes: [
    { id: "n0", label: "A node", x: 0, y: 0, size: 3, color: '#008cc2' },
    { id: "n1", label: "Another node", x: 3, y: 1, size: 2, color: '#008cc2' },
    { id: "n2", label: "And a last one", x: 1, y: 3, size: 1, color: '#E57821' }
  ],
  edges: [
    { id: "e0", source: "n0", target: "n1", color: '#282c34', type:'line', size:0.5 },
    { id: "e1", source: "n1", target: "n2", color: '#282c34', type:'curve', size:1},
    { id: "e2", source: "n2", target: "n0", color: '#FF0000', type:'line', size:2}
  ]
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="loading-graph-in-sigma">Loading graph in sigma</h3>
<div class="paragraph">
<p>Sigma has a complete API to manage its graph data. I let you see the <a href="https://github.com/jacomyal/sigma.js/wiki/Graph-API">API documentation</a>.</p>
</div>
<div class="paragraph">
<p>To load a graph in sigma, you just have to call the method <code>read</code> on the sigma graph instance : <code>s.graph.read(graph)</code></p>
</div>
<div class="paragraph">
<p>Once it&#8217;s done, we need to tell sigma to draw the graph by calling its <code>refresh</code> function : <code>s.refresh()</code></p>
</div>
</div>
<div class="sect2">
<h3 id="live-example">Live example</h3>
<script async src="https://jsfiddle.net/sim51/gxum1dq1/embed/result,js/"></script>
</div>
</div>
</div>
<div class="sect1">
<h2 id="graph-layout-algorithm">Graph layout algorithm</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="definition-2">Definition</h3>
<div class="paragraph">
<p>What is hard in displaying a graph is to rapidly display it in such a way
that we can see all nodes and their edges without overlaps (in fact less as possible).
To do it, we need an algorithm that computes the position of each nodes, and the most known for that are the <strong>force-directed</strong> algorithms.</p>
</div>
<div class="paragraph">
<p>The principle is simple, you need to consider two forces :</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Repulsive</th>
<th class="tableblock halign-left valign-top">Attractive</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Nodes repulse each others. You can consider nodes like particle with the same electric charge.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Two nodes with an edge, attract themselves. You can consider an edge as a spring</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<img src="/public/images/sigmajs/repulsion.png" alt="repulsion">
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="imageblock">
<div class="content">
<img src="/public/images/sigmajs/attraction.png" alt="attraction">
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Then you run an algorithm that compute on each iteration, the sum of the applied forces on each node, and move them in consequence.
After a number of iteration, you will see that graph is in a stable state.</p>
</div>
</div>
<div class="sect2">
<h3 id="force-atlas2">Force-Atlas2</h3>
<div class="paragraph">
<p><a href="http://sigmajs.org">SigmaJS</a> include (as a plugin) a forced-directed algorithm called <strong>Force-Atlas2</strong>.</p>
</div>
<div class="paragraph">
<p>To use it, you need to :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Step 1 : import the plugin files</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;script src="./build/plugins/sigma.layout.forceAtlas2/supervisor.js"&gt;&lt;/script&gt;
&lt;script src="./build/plugins/sigma.layout.forceAtlas2/worker.js"&gt;&lt;/script&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Step 2 : Run it</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now that the plugin is loaded, we can directly call it on the sigma instance : <code>s.startForceAtlas2()</code>;
This creates a <a href="https://developer.mozilla.org/fr/docs/Utilisation_des_web_workers">web worker</a> where all the algorithm iterations will be calculated.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Step 3 (al) : Stop it</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The algorithm won&#8217;t stop by itself, so I recommend you to stop it after a predefined duration (10 seconds in my example) : <code>window.setTimeout(function() {s.killForceAtlas2()}, 10000);</code></p>
</div>
</div>
<div class="sect2">
<h3 id="live-example-2">Live example</h3>
<script async src="https://jsfiddle.net/sim51/xck9a7yf/embed/result,js/"></script>
</div>
</div>
</div>
<div class="sect1">
<h2 id="plugins">Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://sigmajs.org">SigmaJS</a> has a lot of plugins, you can see the list <a href="https://github.com/jacomyal/sigma.js/tree/master/plugins">here</a>.
I will not show you all of them, so I have done a list of my most used plugins.</p>
</div>
<div class="sect2">
<h3 id="edge-labels">Edge labels</h3>
<div class="paragraph">
<p>This plugin allows you to add a label on each edge. I mainly use it to display the Neo4j&#8217;s relationship type.</p>
</div>
<div class="paragraph">
<p>To use it :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Import the needed script (in my case <code>settings.js</code>, <code>sigma.canvas.edges.labels.def.js</code> &amp; <code>sigma.canvas.edges.labels.curvedArrow.js</code>)</p>
</li>
<li>
<p>Add a <code>label</code> property on yours edges</p>
</li>
</ul>
</div>
<script async src="https://jsfiddle.net/sim51/uzmxvg3u/embed/result,js/"></script>
</div>
<div class="sect2">
<h3 id="edge-paralleledges">Edge parallelEdges</h3>
<div class="paragraph">
<p>If you want parallel edges (ie. to have multiple relationship between two nodes), it&#8217;s the plugin you must have.</p>
</div>
<div class="paragraph">
<p>To use it :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Import the needed script :</p>
<div class="ulist">
<ul>
<li>
<p><code>utils.js</code></p>
</li>
<li>
<p><code>sigma.canvas.edges.curvedArrow.js</code>  &amp; <code>sigma.canvas.edgehovers.curvedArrow.js</code> if you have a directed graph.</p>
</li>
<li>
<p><code>sigma.canvas.edgehovers.curve.js</code> &amp; <code>sigma.canvas.edges.curve.js</code>  if you want the an undirected graph.</p>
</li>
<li>
<p><code>sigma.canvas.edges.labels.curve.js</code>  if you have enabled label on edges</p>
</li>
</ul>
</div>
</li>
<li>
<p>Add a property <code>count</code> that represent the index of the edge in the set of parallel edges. Inversely proportional to the amplitude of the vertex of the edge curve.</p>
</li>
</ul>
</div>
<script async src="https://jsfiddle.net/sim51/5vL3e72e/embed/result,js/"></script>
</div>
<div class="sect2">
<h3 id="relative-size">Relative size</h3>
<div class="paragraph">
<p>This plugin is really useful when you want to see which node is most connected.
The size of the node depends of its degree, ie. its number of in-going &amp; outgoing edges.</p>
</div>
<script async src="https://jsfiddle.net/sim51/y7kwmc3g/embed/result,js/"></script>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sigma-and-neo4j">Sigma and Neo4j</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that you know how to use Sigma, the next step is to build a graph visualisation from Neo4j.</p>
</div>
<div class="paragraph">
<p>To do this there is two points :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How to query Neo4j in your browser ?</p>
</li>
<li>
<p>From a query result, how to build a sigma graph structure</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>I will not explain the first point, Michael has already done this part in this <a href="https://medium.com/neo4j/hands-on-graph-data-visualization-bd1f055a492d">excellent post</a>.</p>
</div>
<div class="paragraph">
<p>So let see the second one !</p>
</div>
<div class="sect2">
<h3 id="create-a-graph-structure-from-a-neo4j-query">Create a graph structure from a Neo4j query</h3>
<div class="paragraph">
<p>Result of a query is a collection of tuple, ie. composed of <strong>rows</strong> where each row has some <strong>columns</strong>.
Moreover, each <em>cell</em> is typed, and to display a graph we only want <code>node</code>, <code>relationship</code> and <code>path</code>.</p>
</div>
<div class="paragraph">
<p>To create our data structure, we need to iterate over rows, then over columns and finnaly check the type.
If it&#8217;s a node or relationship, we can add it to our sigma graph structure (if it&#8217;s not already present).</p>
</div>
<div class="paragraph">
<p>And what about <code>path</code>  ? A <code>path</code> in Neo4j driver types, is an array of <code>segment</code> where each segmet is composed of :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a starting node</p>
</li>
<li>
<p>a relationship</p>
</li>
<li>
<p>an ending node</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So if we have a path, we need also to iterate over it to add starting &amp; ending node, plus the relationship.</p>
</div>
<div class="paragraph">
<p>But wait, a Neo4j node (resp. relationship) is not a Sigma node (resp. relationship), so we also need to convert them.</p>
</div>
<div class="paragraph">
<p>If you code it, finally you should have something like this :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">let graph = { nodes:[], edges:[]} ;
this.driver.session().run("MATCH (n)-[r]-&gt;(m) RETURN n,r,m LIMIT $limit", {limit:50}).then(
  (result) =&gt; {
    // for each rows
    result.records.forEach( record =&gt; {
      // for each column
      record.forEach( ( value, key ) =&gt; {
        // if it's a node
        if ( value &amp;&amp; value.hasOwnProperty( 'labels' ) ) {
          graph.nodes.push(convertionToSigmaNode(value));
        }
        // if it's an edge
        if ( value &amp;&amp; value.hasOwnProperty( 'type' ) ) {
          graph.edges.push(convertionToSigmaEdge(value));
        }
        // if it's a path
        if ( value &amp;&amp; value.hasOwnProperty( 'segments' ) ) {
          value.segments.forEach( ( seg ) =&gt; {
            // add starting &amp; ending nodes + relationship
            graph.nodes.push(convertionToSigmaNode(seg.start));
            graph.nodes.push(convertionToSigmaNode(seg.end));
            graph.edges.push(convertionToSigmaEdge(seg.rel));
          });
        }
      });
    })
  })</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here we go, you have everything to display your graph from a Cypher query with SigmaJS !</p>
</div>
<div class="paragraph">
<p>It&#8217;s a little borring, no ? All this code just to display a graph&#8230;&#8203;
And what if I tell you that I have already made the work for you  ?</p>
</div>
</div>
<div class="sect2">
<h3 id="neo4j-sigma-neosig">Neo4j + Sigma = NeoSig</h3>
<div class="paragraph">
<p>To avoid you the complexity of doing all the above work, I have created a library for that : <strong>NeoSig</strong>.</p>
</div>
<div class="paragraph">
<p>To use it, you need to import the library + the Neo4j driver :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;script src="https://cdn.jsdelivr.net/npm/neo4j-driver@1.6.0"&gt;&lt;/script&gt;
&lt;script src="https://cdn.jsdelivr.net/npm/neosig@1.2.2/docs/neosig-1.2.2.js"&gt;&lt;/script&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The library embed SigmaJS (with some customs code) but not the Neo4j driver.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then you can call the function <code>Neo4jGraph(neo4jConfig, neo4jStyle, query, queryParams)</code>, it returns a <em>promise</em> with the sigma graph object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">Neo4jGraph(neo4jConfig, neo4jStyle, 'MATCH (n)-[r]-&gt;(m) RETURN n,r,m LIMIT $limit', {limit:20}).then( function(graph) {
  s.graph.read(graph);
  // enable drag'n'drop
  sigma.plugins.dragNodes(s, s.renderers[0]);
  // start layout
  s.startForceAtlas2();
  setTimeout(() =&gt; { s.stopForceAtlas2() }, Math.log(graph.nodes.length*graph.edges.length)*1000);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>neo4jConfig</code> is an object with :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const neoConfig = {
  url:'bolt://localhost:7867',
  user: 'neo4j',
  password: 'letmein',
  driver : {
    // all the driver configuration (optional)
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And <code>neo4jStyle</code> is :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">const neoStyle = {
  labels: { // Map of label
    Person : {
      label: 'name', // The node's property to display as label
      color: '#654321', // Color of the node
      size: 10, // Size of the node
      icon: { // icon object
        name: 'f007', // Fontawesome unicode
        color: '#FFF', // Color of the font
        scale: 1.0 // Scale ratio
      }
    },
    Movie : {
      label: 'title',
      color: '#123456',
      size: 10,
      icon: {
        name: 'f008',
        color: '#FFF',
        scale: 1.0
      }
    }
  },
  edges: { // Map of edges
    ACTED_IN: { // Name of the relationship type
      label: 'roles',
      //color: '#202020',
      // size: 2
    }
  }
};</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
By default, a node is black, with a size of 5, and the label is its Neo4j&#8217;ID ; a relationship is black with a size of 1, and the label is its Neo4j type.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And the final result is :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/public/images/sigmajs/neosig.png" alt="neosig">
</div>
</div>
<div class="paragraph">
<p>You can see the code here :</p>
</div>
<script src="https://jsfiddle.net/sim51/ep6g95st/embed/js/"></script>
<div class="paragraph">
<p>Now have fun !</p>
</div>
<div class="paragraph">
<p><em>A big thanks to <a href="https://github.com/jacomyal">Jacomyal</a>, <a href="https://github.com/yomguithereal">Yomguithereal</a> and  <a href="https://github.com/astik">Astik</a> for the help !</em></p>
</div>
</div>
</div>
</div>
          </section>
          <footer>
            <ul class="inline pull-right metadata">
              <li >
                <span class="metadata">Tags :</span>
                <span>
                  sigma, graph, visualisation, dataviz
                </span>,
              </li>
              <li >
                <span class="metadata">Auteur :</span>
                <span>
                  <a itemprop="author" href="about-me.html" title="Benoît Simard" rel="author">Benoit Simard</a>
                </span>,
              </li>
              <li>
                <span class="metadata">Created at :</span>
                <time itemprop="dateCreated" datetime="2018-04-25">Apr 25, 2018</time>
              </li>
              <li><a href="" title="Permalien : How to use Sigmajs to display your graph ?" itemprop="url">Permalink</a></li>
            </ul>
          </footer>
        </div>
      </article>

      <section id="disqus_thread"></section>

      <nav class="row-fluid blog" data-spy="affix" data-offset-top="200">
        <div class="alpha-wrapper"></div>
        <div class="span12">
          <ul class="unstyled">
            
            <li class="pull-left">
              <a class="btn btn-primary" href="/2017/11/23/fr-import-matrice-adjacence.html" title="Importer une matrice d&#8217;adjacence">&lt; Importer une matrice d&#8217;adjacence</a>
            </li>
            
            
            <li class="pull-right">
              <a class="btn btn-primary" href="/2018/05/22/fr-monitoring-neo4j-influxdb.html" title="[EN] Monitoring Neo4j with influxdb TICK stack">[EN] Monitoring Neo4j with influxdb TICK stack &gt;</a>
            </li>
            
          </ul>
        </div>
      </nav>

    </section>
  </section>

  <footer id="footer" class="hidden-print">
  <div class=" blockOdd">
    <div class="container">
      <div class="row-fluid">

        <div class="span4">
          <ul class="pull-left inline">
            <li>
              <a href="http://creativecommons.org/licenses/by-sa/3.0/" title="Creative commons : BY-SA">
                <img alt="CC-BY-SA" src="/public/images/cc-by-sa.png" class="middle">
              </a>
            </li>
            <li>|</li>
            <li id="mentions">
            </li>
          </ul>
        </div>

        <div class="span8">
          <ul class="pull-right inline">
            <li>
              <a href="mailto:contact@bsimard.com" title="Contact me">
                <i class="icon-envelope"></i>
              </a>
            </li>
            <li>
              <a href="https://www.twitter.com/logisima" title="Follow-me on Twitter">
                <i class="icon-twitter"></i>
              </a>
            </li>
            <li>
              <a href="https://www.github.com/sim51" title="My github account">
                <i class="icon-github-alt"></i>
              </a>
            </li>
            <li>
              <a href="http://www.linkedin.com/pub/beno%C3%AEt-simard/5/8a5/124" title="My profile on Linked-in">
                <i class="icon-linkedin"></i>
              </a>
            </li>
          </ul>
        </div>

      </div>
    </div>
  </div>
</footer>


<script src="/public/javascripts/jquery.min.js" type="text/javascript"></script>
<script src="/public/javascripts/bootstrap.min.js" type="text/javascript"></script>
<script src="/public/codemirror/lib/codemirror.js"></script>
<script src="/public/codemirror/mode/cypher/cypher.js"></script>
<script src="/public/codemirror/mode/javascript/javascript.js"></script>
<script src="/public/codemirror/mode/properties/properties.js"></script>
<script src="/public/codemirror/mode/sql/sql.js"></script>
<script src="/public/codemirror/mode/xml/xml.js"></script>
<script src="/public/codemirror/mode/shell/shell.js"></script>
<script src="/public/codemirror/mode/htmlmixed/htmlmixed.js"></script>

<!-- Addthis -->
<script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4fe07fd564a65b88"></script>
<script type="text/javascript">
  addthis.layers({
    'theme' : 'transparent',
    'share' : {
      'position' : 'right',
      'numPreferredServices' : 5
    }
  });
</script>

<!-- Disqus -->
<script type="text/javascript">
  
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'bsimard';
  var disqus_identifier = '/2018/04/25/graph-viz-with-sigmajs';

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<!-- GA -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-10125951-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-10125951-1');
</script>

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  <script>
    $("code").each(function() {
        var lang = $(this).attr('data-lang');

        if(lang) {
            $(this).html("<textarea>" + $(this).html() + "<\/textarea>");
            CodeMirror.fromTextArea($(this).find('textarea')[0], { 'readonly':true, 'mode':lang, 'theme':'neo', 'lineNumbers':true, 'lineWrapping':true});
        }
    });
  </script>
</body>
</html>
